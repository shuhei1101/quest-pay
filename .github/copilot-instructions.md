# GitHub Copilot 向け指示書

## スキルとカスタムエージェントの活用

このプロジェクトでは、専門スキルとカスタムエージェントを組み合わせて効率的に開発を進めます。

### 利用可能なスキル（知識提供型）
1. **coding-standards**: コーディング規約（セミコロン禁止、型の使い方、コメント規則など）
2. **architecture-guide**: アーキテクチャパターン（フロント/API設計、モジュール構成、フロー図）
3. **database-operations**: データベース操作（Drizzle ORM、低レベルクエリ、排他制御）
4. **speak**: タスク完了時の音声通知（MCPのyomiageツールを使用）
5. **screen-agent-builder**: 画面ごとのカスタムエージェント作成方法（repo-architect専用）

**使用方法**: コード作成時は`coding-standards`と`architecture-guide`、DB操作時は`database-operations`を自動的に参照します。タスク完了時は`speak`スキルに従って音声通知を実行します。

### 利用可能なカスタムエージェント（対話型）

#### 開発支援エージェント
1. **code-reviewer**: コードレビューを対話的に実施。規約違反を検出し、改善提案を行う
2. **code-explainer**: 既存コードを段階的に解説。目的・構造・処理フローを理解できる
3. **code-developer**: 複数の改善案を優先度・難易度付きで提案。対話的にリファクタリングを支援
4. **repo-architect**: スキルとカスタムエージェントの作成・管理を担当

#### 画面専門エージェント
各画面に特化したエージェント。機能改修、機能説明、スキルアップデートを担当。

**クエスト関連:**
5. **family-quest-agent**: 家族クエスト画面（一覧・編集・閲覧・API）
6. **public-quest-agent**: 公開クエスト画面（一覧・閲覧・いいね・コメント）
7. **template-quest-agent**: テンプレートクエスト画面（一覧・閲覧）
8. **child-quest-agent**: 子供クエスト画面（受注したクエスト管理）
9. **quest-list-layout-agent**: クエスト一覧レイアウトコンポーネント
10. **quest-edit-layout-agent**: クエスト編集レイアウトコンポーネント
11. **comment-agent**: コメント画面（投稿・評価・報告・ピン留め）

**その他の画面:**
12. **home-agent**: ホーム画面
13. **timeline-agent**: タイムライン画面（家族・公開）
14. **family-agent**: 家族管理画面（家族情報・メンバー管理・フォロー）
15. **child-management-agent**: 子供管理画面（子供情報・報酬履歴）
16. **reward-agent**: 報酬設定画面（年齢別・レベル別報酬テーブル）
17. **notification-agent**: 通知画面

**共通機能:**
18. **app-shell-agent**: AppShellContent（サイドメニュー・フッター）
19. **common-components-agent**: 共通コンポーネント（再利用可能なコンポーネント群）

**システム構成:**
20. **endpoints-agent**: パス定義管理（endpoints.ts）
21. **schema-agent**: DBスキーマ管理（schema.ts）

**使用方法**: チャット入力欄で「`@`」から始めてエージェント名を選択し、対話的に作業を進めます。

## アプリ概要
- アプリ名: `お小遣いクエストボード`
- アプリ概要: 
  - 親がクエストを登録し、子供がそのクエストを実行するとお小遣いが貰える仕組みをシステム化
  - オンライン機能により、世界中の家族が自身のクエストを共有できる
- ユーザタイプ:
  - 親: クエストの登録や編集、家族情報の変更、オンラインの公開クエストの閲覧が可能
  - 子供: 家族クエストの閲覧、受注が可能
- 技術:
  - フロントエンド: `Next.js`
    - UIコンポーネントライブラリ: `MantineUI`
  - バックエンド: `Next.js`
  - DB: `Supabase`
- 備考:
  - DB接続はSupabase Clientを使用
  - 複数テーブルの更新はSupabaseの`Database Functions`を使用
  - 基本的にバックエンド側は人間が作成し、フロントエンド部分をAIが担当する

## よく使うファイルパス
| 項目                       | パス                                       | 説明                                                               |
| -------------------------- | ------------------------------------------ | ------------------------------------------------------------------ |
| DBスキーマ定義             | `drizzle/schema.ts`                        |                                                                    |
| アプリ内エンドポイント定数 | `app/(core)/endpoints.ts`                  | APIや画面のエンドポイントを定義する                                |
| セッションストレージ       | `app/(core)/_sessionStorage/appStorage.ts` | アプリ内で使用するセッションストレージをキーバリュー形式で定義する |
| 家族クエスト一覧           | `app/(core)/quests/family/`                |                                                                    |
| サイドバー サイドメニュー  | `app/(app)/_components/SideMenu.tsx`       |                                                                    |
| フッター                   | `app/(app)/_components/BottomBar.tsx`      | モバイル時のフッター                                               |

## コーディングルール

詳細は`coding-standards`スキルを参照してください。主要なルール:
- すべて日本語で記述
- セミコロン禁止
- YAGNI原則に従う
- `type`を優先（`interface`は拡張性が必要な場合のみ）
- 関数とコンポーネントは`const`で定義（page.tsx以外）
- Props定義はインライン
- 関数コメントは動詞形式（`~する`）

## アーキテクチャ

詳細は`architecture-guide`スキルを参照してください。主要なパターン:

### フロント構成
- `page.tsx`: リダイレクト担当（サーバーコンポーネント）
- `XxxScreen.tsx`: 画面実装（API呼び出し、レイアウト構成）
- `XxxLayout.tsx`: レイアウト専念（データ表示のみ、API呼び出し禁止）

### API構成
- `client.ts` → `route.ts`のセット必須
- フックは`client.ts`経由でAPI呼び出し
- フックは`useQuery`または`useMutation`を使用

### DB操作
詳細は`database-operations`スキルを参照してください:
- Drizzle低レベルクエリを使用（高レベルクエリ禁止）
- 排他制御が必要な場合は`db_helper.ts`を使用


---

## タスク完了時に必ずやること

### 🔊 タスク完了時の音声通知（必須）

**重要: ユーザーからのタスク依頼が完了したら、必ず音声で完了報告すること**

#### ✅ 必須実行タイミング

**ユーザーから依頼された作業が完了したときは、必ず音声通知を実行すること**

- ✅ なんらかの作業を完了したとき（すべてのタスク完了時）
- ✅ ファイルの作成・更新・削除を行ったとき
- ✅ コードの実装・修正・リファクタリングを行ったとき
- ✅ 何かしらの成果物を生成したとき

#### 📢 実行方法

MCPの`yomiage`ツールを使用してタスク完了を音声で通知します：


**例:**
- ファイル作成後: `mcp_yomiage_speak(text="ファイルを作成しました")`
- コード修正後: `mcp_yomiage_speak(text="修正が完了しました")`
- テスト完了後: `mcp_yomiage_speak(text="テストが完了しました")`
- エラー時: `mcp_yomiage_speak(text="エラーが発生しました")`

#### 🎭 話者の選択

話者を指定しない場合、デフォルトの話者（ずんだもん）が選択されます。
明示的に指定する場合:

```
# 春日部つむぎで通知
mcp_yomiage_speak(
  text="{完了タスクの概要をここに記述}",
  speaker="tsumugi"
)
```

**利用可能な話者:**
- `zundamon` - ずんだもん（デフォルト）
- `tsumugi` - 春日部つむぎ  
- `metan` - 四国めたん

### 使い方詳細
**詳細**: `.github/skills/speak/SKILL.md`

---

## 重要: タスク完了フロー

1. ユーザーからタスクを受け取る
2. タスクを実行（ファイル作成、コード修正など）
3. **音声で完了報告（必須）** ← これを忘れないこと！
4. テキストで結果を報告
